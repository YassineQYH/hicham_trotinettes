{% extends 'base.html.twig' %}

{% block title %}{{ trottinette.name }}{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('assets/css/show-product-slider.css') }}">
    <link rel="stylesheet" href="{{ asset('assets/css/slide-img-product-show.css') }}">
    <link rel="stylesheet" href="{{ asset('assets/css/products.css') }}">
{% endblock %}

{% block content %}

<!-- SECTION 1 : SLIDER PRINCIPAL -->
<section class="cart__slide" id="slider-show">
  <div class="arrival__slide container">
    <div class="glide" id="glide1">
      <div class="glide__track" data-glide-el="track">
        <ul class="glide__slides">

          <!-- Image principale -->
          <li class="glide__slide">
            <div class="arrival">
              <div class="cart__like">
                <div class="image__holder">
                  <img src="/uploads/trottinettes/{{ trottinette.image }}" alt="{{ trottinette.name }}">
                </div>
                <div class="cart__details">
                  <h1>{{ trottinette.name }}</h1>
                  <p>{{ trottinette.descriptionShort ?? 'Aucune description courte disponible.' }}</p>
                </div>
              </div>
            </div>
          </li>

          <!-- Images supplémentaires -->
          {% for item in illustrations %}
            <li class="glide__slide">
              <div class="arrival">
                <div class="cart__like">
                  <div class="image__holder">
                    <img src="/uploads/trottinettes/{{ item.image }}" alt="{{ trottinette.name }}">
                  </div>
                  <div class="cart__details">
                    <h1>{{ trottinette.name }}</h1>
                    <p>{{ trottinette.descriptionShort ?? 'Aucune description courte disponible.' }}</p>
                  </div>
                </div>
              </div>
            </li>
          {% endfor %}
        </ul>
      </div>

      <!-- Flèches et miniatures restent inchangées -->
      <div class="glide__arrows" data-glide-el="controls">
        <button class="glide__arrow glide__arrow--left" data-glide-dir="<">Précédent</button>
        <button class="glide__arrow glide__arrow--right" data-glide-dir=">">Suivant</button>
      </div>

      <div class="glide__bullets" data-glide-el="controls[nav]">
        <button class="glide__bullet" data-glide-dir="=0">
          <img src="/uploads/trottinettes/{{ trottinette.image }}" alt="{{ trottinette.name }}">
        </button>
        {% for key, item in illustrations %}
          <button class="glide__bullet" data-glide-dir="={{ key + 1 }}">
            <img src="/uploads/trottinettes/{{ item.image }}" alt="{{ trottinette.name }}">
          </button>
        {% endfor %}
      </div>
    </div>

    <!-- BOUTONS FIXES À DROITE -->
    <div class="cart__buttons">
        {% set product_id = trottinette.id %}
        {% set cart_data = cart.get() ?? {} %}
        {% set quantity_in_cart = cart_data['trottinette'][product_id]|default(0) %}

        {% if trottinette.stock < 1 %}
            {# Aucun stock, on affiche seulement "Bientôt de retour" #}
            <a class="buy-btn">Bientôt de retour</a>

        {% else %}
            {# Toujours afficher le stock disponible #}
            <a class="buy-btn">Stock disponible : {{ trottinette.stock }}</a><br>

            {% if quantity_in_cart == 0 %}
                {# Produit pas encore ajouté au panier #}
                <a href="{{ path('add_to_cart', {'id': product_id, 'type': 'trottinette'}) }}" class="buy-btn">Ajouter</a>

            {% elseif quantity_in_cart < trottinette.stock %}
                {# Produit ajouté mais pas au max du stock #}
                <a class="buy-btn">Quantité : {{ quantity_in_cart }}</a><br>
                <a href="{{ path('add_to_cart', {'id': product_id, 'type': 'trottinette'}) }}" class="buy-btn">Ajouter</a>
                <a href="{{ path('decrease_to_cart', {'id': product_id, 'type': 'trottinette'}) }}" class="buy-btn">Diminuer</a><br>

            {% else %}
                {# Produit au maximum du stock #}
                <a class="buy-btn">Quantité : {{ quantity_in_cart }}</a><br>
                <a href="{{ path('decrease_to_cart', {'id': product_id, 'type': 'trottinette'}) }}" class="buy-btn">Diminuer</a><br>
                <a class="buy-btn" style="color:red;">Max (rupture)</a>
            {% endif %}
        {% endif %}
    </div>



  </div>
</section>


<!-- SECTION 2 : CARACTÉRISTIQUES -->
<section class="trottinette-caracteristiques container">
  <h2>Caractéristiques techniques</h2>

  {% if caracteristiques is not empty %}
      {% set categories = {} %}
      {% for c in caracteristiques %}
          {% set cat = c.categorie ? c.categorie.name : 'Autres' %}
          {% set categories = categories|merge({ (cat): (categories[cat]|default([]))|merge([c]) }) %}
      {% endfor %}

      {% for cat, items in categories %}
          <div class="caracteristique-categorie">
              <h3>{{ cat }}</h3>
              <table class="caracteristiques-table">
                  {% for item in items %}
                      <tr>
                          <td class="carac-name">
                              {{ item.title ?? item.caracteristique.name }}
                          </td>
                          <td class="carac-value">
                              {{ item.value }}
                          </td>
                      </tr>
                  {% endfor %}
              </table>
          </div>
      {% endfor %}
  {% else %}
      <p>Aucune caractéristique enregistrée pour cette trottinette.</p>
  {% endif %}
</section>

<!-- SECTION 3 : DESCRIPTIONS DÉTAILLÉES -->
<section class="trottinette-descriptions container">
  <h2>Description complète</h2>

  {% if sections is not empty %}
      {% for section in sections|sort((a,b) => a.sectionOrder <=> b.sectionOrder) %}
          <div class="description-section">
              <h3>{{ section.title }}</h3>
              <p>{{ section.content|raw }}</p>
          </div>
      {% endfor %}
  {% else %}
      <p>Aucune section de description disponible.</p>
  {% endif %}
</section>

<script src="{{ asset('assets/js/slide-img.js') }}" type="text/javascript"></script>
{% endblock %}
