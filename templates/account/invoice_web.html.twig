{% extends 'base.html.twig' %}

{% block title %}Facture {{ order.reference }}{% endblock %}

{% block content %}
<div class="facture" style="width:105mm; padding:5mm; border:1px solid #000; font-family:Arial, sans-serif; font-size:12px; margin:0 auto;">

    <h1>Facture - {{ order.reference }}</h1>

    <div>
        <strong>Vendeur :</strong> Hich-Trott<br>
        <strong>Adresse :</strong> 123 Rue Exemple, 75000 Paris<br>
        <strong>Email :</strong> contact@hich-trott.fr
    </div>

    <div style="margin-top:5px;">
        <strong>Client :</strong> {{ order.user.firstName }} {{ order.user.lastName }}<br>
        <strong>Adresse :</strong> {{ order.delivery|raw }}
    </div>

    <hr>

    <table style="width:100%; border-collapse:collapse; font-size:11px;">
        <thead>
            <tr>
                <th style="border:1px solid #000; padding:2px;">Produit</th>
                <th style="border:1px solid #000; padding:2px;">Quantité</th>
                <th style="border:1px solid #000; padding:2px;">Poids</th>
                <th style="border:1px solid #000; padding:2px;">Prix unitaire HT</th>
                <th style="border:1px solid #000; padding:2px;">Total HT</th>
                <th style="border:1px solid #000; padding:2px;">TVA</th>
            </tr>
        </thead>
        <tbody>
            {% set totalHT = 0 %}
            {% set totalTVA = 0 %}
            {% for item in order.orderDetails %}
                {% set totalItemHT = item.price * item.quantity %}
                {% set tvaItem = totalItemHT * (item.tva / 100) %}
                <tr>
                    <td style="border:1px solid #000; padding:2px;">{{ item.product }}</td>
                    <td style="border:1px solid #000; padding:2px;">x{{ item.quantity }}</td>
                    <td style="border:1px solid #000; padding:2px;">{{ item.weight * item.quantity }} kg</td>
                    <td style="border:1px solid #000; padding:2px;">{{ (item.price / 100)|number_format(2, ',', '.') }} €</td>
                    <td style="border:1px solid #000; padding:2px;">{{ (totalItemHT / 100)|number_format(2, ',', '.') }} €</td>
                    <td style="border:1px solid #000; padding:2px;">{{ (tvaItem / 100)|number_format(2, ',', '.') }} €</td>
                </tr>
                {% set totalHT = totalHT + totalItemHT %}
                {% set totalTVA = totalTVA + tvaItem %}
            {% endfor %}
        </tbody>
    </table>

    {% set totalTTC = (totalHT + totalTVA + order.carrierPrice * 100) / 100 %}

    <table style="width:100%; border-collapse:collapse; font-size:11px; margin-top:5px;">
        <tbody>
            <tr><td>Sous-total HT :</td><td>{{ (totalHT / 100)|number_format(2, ',', '.') }} €</td></tr>
            <tr><td>TVA :</td><td>{{ (totalTVA / 100)|number_format(2, ',', '.') }} €</td></tr>
            <tr><td>Frais de livraison :</td><td>{{ (order.carrierPrice)|number_format(2, ',', '.') }} €</td></tr>
            <tr><td><strong>Total TTC :</strong></td><td><strong>{{ totalTTC|number_format(2, ',', '.') }} €</strong></td></tr>
        </tbody>
    </table>

    <div class="footer" style="font-size:10px; margin-top:5px; color:gray;">
        Merci pour votre commande !<br>
        Hich-Trott - Tous droits réservés.
    </div>
</div>
{% endblock %}
