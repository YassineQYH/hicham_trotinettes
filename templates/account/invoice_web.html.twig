{% extends 'base.html.twig' %}

{% block title %}Facture {{ order.reference }}{% endblock %}

{% block content %}
<div class="facture" style="width:105mm; padding:5mm; border:1px solid #000; font-family:Arial, sans-serif; font-size:12px; margin:0 auto;">

    <h1 style="font-size:14px; margin-bottom:5px;">Facture - {{ order.reference }}</h1>

    <div>
        <strong>Vendeur :</strong> Hich-Trott<br>
        <strong>Adresse :</strong> 123 Rue Exemple, 75000 Paris<br>
        <strong>Email :</strong> contact@hich-trott.fr
    </div>

    <div style="margin-top:5px;">
        <strong>Client :</strong> {{ order.user.firstName }} {{ order.user.lastName }}<br>
        <strong>Adresse :</strong> {{ order.delivery|raw }}
    </div>

    <hr>

    <table style="width:100%; border-collapse:collapse; font-size:11px;">
        <thead>
            <tr>
                <th style="border:1px solid #000; padding:2px;">Produit</th>
                <th style="border:1px solid #000; padding:2px;">Quantité</th>
                <th style="border:1px solid #000; padding:2px;">Poids</th>
                <th style="border:1px solid #000; padding:2px;">Prix unitaire HT</th>
                <th style="border:1px solid #000; padding:2px;">Total HT</th>
                <th style="border:1px solid #000; padding:2px;">TVA</th>
                <th style="border:1px solid #000; padding:2px;">Total TTC</th>
            </tr>
        </thead>
        <tbody>
            {% set totalProduitsHT = 0 %}
            {% set totalTVA = 0 %}
            {% for item in order.orderDetails %}
                {% set totalItemHT = item.price * item.quantity %}
                {% set tvaItem = totalItemHT * (item.tva / 100) %}
                {% set totalItemTTC = totalItemHT + tvaItem %}

                {% set totalProduitsHT = totalProduitsHT + totalItemHT %}
                {% set totalTVA = totalTVA + tvaItem %}
            {% endfor %}

            {% set totalProduitsTTC = totalProduitsHT + totalTVA %}
            {% set promo = order.promoReduction ?? 0 %}
            {% set totalCommande = totalProduitsTTC - promo + order.carrierPrice %}

            <table style="width:100%; border-collapse:collapse; font-size:11px; margin-top:5px;">
                <tbody>
                    <tr>
                        <td>Sous-total HT :</td>
                        <td>{{ totalProduitsHT|number_format(2, ',', '.') }} €</td>
                    </tr>
                    <tr>
                        <td>TVA :</td>
                        <td>{{ totalTVA|number_format(2, ',', '.') }} €</td>
                    </tr>
                    <tr>
                        <td><strong>Total TTC produits :</strong></td>
                        <td>{{ totalProduitsTTC|number_format(2, ',', '.') }} €</td>
                    </tr>
                    {% if promo > 0 %}
                    <tr>
                        <td><strong>Réduction ({{ order.promoTitre ?? order.promoCode }}):</strong></td>
                        <td>-{{ promo|number_format(2, ',', '.') }} €</td>
                    </tr>
                    {% endif %}
                    <tr>
                        <td>Frais de livraison :</td>
                        <td>{{ order.carrierPrice|number_format(2, ',', '.') }} €</td>
                    </tr>
                    <tr>
                        <td><strong>Total TTC :</strong></td>
                        <td><strong>{{ totalCommande|number_format(2, ',', '.') }} €</strong></td>
                    </tr>
                </tbody>
            </table>



    <div class="footer" style="font-size:10px; margin-top:5px; color:gray;">
        Merci pour votre commande !<br>
        Hich-Trott - Tous droits réservés.
    </div>
</div>
{% endblock %}
