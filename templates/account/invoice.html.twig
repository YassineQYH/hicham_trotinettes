<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Facture {{ order.reference }}</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            font-size: 12px;
            margin: 0;
            padding: 5px;
        }
        .facture {
            width: 105mm; /* A6 portrait */
            height: auto;
            padding: 5mm;
            border: 1px solid #000;
            box-sizing: border-box;
        }
        h1, h2, h3 { margin: 0; padding: 0; }
        h1 { font-size: 14px; margin-bottom: 5px; }
        h2 { font-size: 12px; margin-top: 5px; }
        table { width: 100%; border-collapse: collapse; margin-top: 5px; font-size: 11px; }
        th, td { border: 1px solid #000; padding: 2px; text-align: left; }
        .footer { font-size: 10px; margin-top: 5px; color: gray; }
    </style>
</head>
<body>
<div class="facture">
    <h1>Facture - {{ order.reference }}</h1>

    <div>
        <strong>Vendeur :</strong> Hich-Trott<br>
        <strong>Adresse :</strong> 123 Rue Exemple, 75000 Paris<br>
        <strong>Email :</strong> contact@hich-trott.fr
    </div>

    <div style="margin-top:5px;">
        <strong>Client :</strong> {{ order.user.firstName }} {{ order.user.lastName }}<br>
        <strong>Adresse :</strong> {{ order.delivery|raw }}
    </div>

    <hr>

    <table>
        <thead>
            <tr>
                <th>Produit</th>
                <th>Quantité</th>
                <th>Poids</th>
                <th>Prix unitaire HT</th>
                <th>Total HT</th>
                <th>TVA</th>
            </tr>
        </thead>
        <tbody>
            {% set totalHT = 0 %}
            {% set totalTVA = 0 %}
            {% for item in order.orderDetails %}
                {% set totalItemHT = item.price * item.quantity %}
                {% set tvaItem = totalItemHT * (item.tva / 100) %}
                <tr>
                    <td>{{ item.product }}</td>
                    <td>x{{ item.quantity }}</td>
                    <td>{{ item.weight * item.quantity }} kg</td>
                    <td>{{ (item.price / 100)|number_format(2, ',', '.') }} €</td>
                    <td>{{ (totalItemHT / 100)|number_format(2, ',', '.') }} €</td>
                    <td>{{ (tvaItem / 100)|number_format(2, ',', '.') }} €</td>
                </tr>
                {% set totalHT = totalHT + totalItemHT %}
                {% set totalTVA = totalTVA + tvaItem %}
            {% endfor %}
        </tbody>
    </table>

    {% set totalTTC = (totalHT + totalTVA + order.carrierPrice * 100) / 100 %}

    <table style="margin-top:5px;">
        <tbody>
            <tr><td>Sous-total HT :</td><td>{{ (totalHT / 100)|number_format(2, ',', '.') }} €</td></tr>
            <tr><td>TVA :</td><td>{{ (totalTVA / 100)|number_format(2, ',', '.') }} €</td></tr>
            <tr><td>Frais de livraison :</td><td>{{ (order.carrierPrice)|number_format(2, ',', '.') }} €</td></tr>
            <tr><td><strong>Total TTC :</strong></td><td><strong>{{ totalTTC|number_format(2, ',', '.') }} €</strong></td></tr>
        </tbody>
    </table>

    <div class="footer">
        Merci pour votre commande !<br>
        Hich-Trott - Tous droits réservés.
    </div>
</div>
</body>
</html>
