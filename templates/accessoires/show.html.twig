{% extends 'base.html.twig' %}

{% block title %}{{ accessory.name }}{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('assets/css/show-product-slider.css') }}">
    <link rel="stylesheet" href="{{ asset('assets/css/slide-img-product-show.css') }}">
    <link rel="stylesheet" href="{{ asset('assets/css/products.css') }}">
{% endblock %}

{% block content %}
<br><br><br><br><br><br><br><br>

<!-- Cart Slide -->
<section class="cart__slide" id="slider-show">
  <div class="arrival__slide container">
    <div class="glide" id="glide1">
      <div class="glide__track" data-glide-el="track">
        <ul class="glide__slides">

          {# Slide principale #}
          <li class="glide__slide">
            <div class="arrival">
              <div class="cart__like">
                <div class="image__holder">
                  <img src="/uploads/accessoires/{{ accessory.image }}" alt="{{ accessory.name }}" />
                </div>
                <div class="cart__details">
                  <h1>{{ accessory.name }}</h1>
                  <p>{{ accessory.descriptionShort ?? 'Aucune description courte disponible.' }}</p>
                </div>
              </div>
            </div>
          </li>

          {# Slides illustrations #}
          {% for item in illustrations %}
            <li class="glide__slide">
              <div class="arrival">
                <div class="cart__like">
                  <div class="image__holder">
                    <img src="/uploads/accessoires/{{ item.image }}" alt="{{ accessory.name }}" />
                  </div>
                  <div class="cart__details">
                    <h1>{{ accessory.name }}</h1>
                    <p>{{ accessory.descriptionShort ?? 'Aucune description courte disponible.' }}</p>
                  </div>
                </div>
              </div>
            </li>
          {% endfor %}
        </ul>
      </div>

      <!-- Arrows -->
      <div class="glide__arrows" data-glide-el="controls">
        <button class="glide__arrow glide__arrow--left" data-glide-dir="<">Précédent</button>
        <button class="glide__arrow glide__arrow--right" data-glide-dir=">">Suivant</button>
      </div>

      <!-- Miniatures (bullets personnalisées) -->
      <div class="glide__bullets" data-glide-el="controls[nav]">

        {# Image principale #}
        <button class="glide__bullet" data-glide-dir="=0">
          <div class="thumbnail">
            <img src="/uploads/accessoires/{{ accessory.image }}" alt="{{ accessory.name }}" />
          </div>
        </button>

        {# Illustrations #}
        {% for key, item in illustrations %}
          <button class="glide__bullet" data-glide-dir="={{ key + 1 }}">
            <div class="thumbnail">
              <img src="/uploads/accessoires/{{ item.image }}" alt="{{ accessory.name }}" />
            </div>
          </button>
        {% endfor %}
      </div>
    </div>

    <!-- BOUTONS FIXES À DROITE -->
    <div class="cart__buttons">
        {% set product_id = accessory.id %}
        {% set cart_data = cart.get() ?? {} %}
        {% set quantity_in_cart = cart_data['accessory'][product_id]|default(0) %}

        {% if accessory.stock < 1 %}
            <a class="buy-btn">Bientôt de retour</a>

        {% else %}
            {# Toujours afficher le stock #}
            <a class="buy-btn">Stock disponible : {{ accessory.stock }}</a><br>

            {% if quantity_in_cart == 0 %}
                <a href="{{ path('add_to_cart', {'id': product_id, 'type': 'accessory'}) }}" class="buy-btn">Ajouter</a>

            {% elseif quantity_in_cart < accessory.stock %}
                <a class="buy-btn">Quantité : {{ quantity_in_cart }}</a><br>
                <a href="{{ path('add_to_cart', {'id': product_id, 'type': 'accessory'}) }}" class="buy-btn">Ajouter</a>
                <a href="{{ path('decrease_to_cart', {'id': product_id, 'type': 'accessory'}) }}" class="buy-btn">Diminuer</a><br>
            {% else %}
                <a class="buy-btn">Quantité : {{ quantity_in_cart }}</a><br>
                <a href="{{ path('decrease_to_cart', {'id': product_id, 'type': 'accessory'}) }}" class="buy-btn">Diminuer</a><br>
                <a class="buy-btn" style="color:red;">Max (rupture)</a>
            {% endif %}

            {# Ajout du prix TTC #}
            {% set tvaRate = (trottinette.tva.value ?? 20) / 100 %}
            {% set priceTTC = accessory.price * (1 + tvaRate) %}
            <a class="buy-btn" style="margin-top:5px;">Prix TTC : {{ priceTTC|number_format(2, ',', '.') }} €</a>
        {% endif %}
    </div>


  </div>
</section>

<script src="{{ asset('assets/js/slide-img.js') }}" type="text/javascript"></script>
{% endblock %}
